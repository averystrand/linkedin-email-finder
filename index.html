<script>
  async function lookupEmail() {
    const url = document.getElementById("linkedinUrl").value.trim();
    const resultBox = document.getElementById("result");
    resultBox.textContent = "Looking up...";

    if (!url) {
      resultBox.textContent = "Please enter a LinkedIn URL.";
      return;
    }

    try {
      await fetch("https://linkedin-email-finder-proxy.vercel.app/api/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ Linkedin_URL: url })
      });

      resultBox.textContent = "Waiting for enrichmentâ€¦";

      let email = null;
      let attempts = 0;

      while (!email && attempts < 20) {
        attempts++;
        await new Promise(r => setTimeout(r, 3000));

        const res = await fetch(`https://linkedin-email-finder-proxy.vercel.app/api/notify?url=${encodeURIComponent(url)}`);
        const data = await res.json();
        email = data?.normalized?.Email;
      }

      resultBox.textContent = email ? `Email: ${email}` : "No email found.";
    } catch (err) {
      resultBox.textContent = "Error: " + err.message;
    }
  }
</script>
